autoload -U colors
colors
setopt prompt_subst
setopt CORRECT
setopt COMPLETE_IN_WORD
setopt MENU_COMPLETE

autoload compinit
compinit

# Say how long a command took, if it took more than 30 seconds
export REPORTTIME=30

# match uppercase from lowercase
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}'

# Use arrows to navigate completion options
zstyle ':completion:*' menu select=1 _complete _ignored _approximate

# Quote pasted URLs
autoload url-quote-magic
zle -N self-insert url-quote-magic

# History settings
HISTFILE=~/.zsh_history
SAVEHIST=10000
HISTSIZE=10000
setopt APPEND_HISTORY
setopt INC_APPEND_HISTORY
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_REDUCE_BLANKS
setopt HIST_SAVE_NO_DUPS
setopt HIST_VERIFY

# Make CTRL-W delete after other chars, not just spaces
WORDCHARS=${WORDCHARS//[&=\/;\!#%\{]}

bindkey -e

# Fix delete key
bindkey "^[[3~" delete-char

## PATHS

export PATH=/Applications/Postgres.app/Contents/MacOS/bin:/usr/local/bin:~/bin:/usr/local/sbin:/usr/local/share/npm/bin:$PATH
export NODE_PATH=/usr/local/lib/node

hash mvim &>/dev/null
if [ $? -eq 0 ]; then
  export EDITOR='mvim -v'
fi

## rbenv  https://github.com/sstephenson/rbenv
export PATH="$HOME/.rbenv/bin:$PATH"
eval "$(rbenv init -)"

# Add colors to grep/ls
export GREP_OPTIONS="--color"
export LSCOLORS="ExGxBxDxCxEgEdxbxgxcxd"

# Setup prompts
local lastcmdstatus="%(?,%{$fg[green]%}→%{$reset_color%},%{$fg[red]%}→%{$reset_color%})"

PROMPT='
%~
${lastcmdstatus} %{$reset_color%}'

RPROMPT='%{$fg[white]%}$(~/bin/git-cwd-info)%{$reset_color%}'

# Set Apple Terminal.app resume directory
if [[ $TERM_PROGRAM == "Apple_Terminal" ]] && [[ -z "$INSIDE_EMACS" ]]; then
  function chpwd {
    local SEARCH=' '
    local REPLACE='%20'
    local PWD_URL="file://$HOSTNAME${PWD//$SEARCH/$REPLACE}"
    printf '\e]7;%s\a' "$PWD_URL"
  }

  chpwd
fi

# vim: set syntax=sh:
